const express=require("express"),app=express(),port=3e3,bodyParser=require("body-parser"),cors=require("cors"),mongoose=require("mongoose"),bcrypt=require("bcryptjs"),config=require("./config.json"),Users=require("./models/users"),Listings=require("./models/listings");mongoose.connect(`mongodb+srv://${config.MONGO_USERNAME}:${config.MONGO_PASSWORD}@${config.CLUSTER_NAME}.mongodb.net/${config.TABLE_NAME}?retryWrites=true&w=majority`,{useNewUrlParser:!0,useUnifiedTopology:!0});const db=mongoose.connection;db.on("error",console.error.bind(console,"connection error:")),db.once("open",()=>{console.log("we are connected mongo db")}),app.use(bodyParser.json()),app.use(bodyParser.urlencoded({extended:!1})),app.use(cors()),app.use((e,o,s)=>{console.log(`${e.method} request for ${e.url}`),s()}),app.get("/",(e,o)=>{o.send("Welcome to our Pop Culture Merchandise Niche Market App")}),app.post("/login",(e,o)=>{Users.findOne({username:e.body.username},(s,n)=>{n?bcrypt.compareSync(e.body.password,n.password)?o.send(n):o.send("Invalid Password"):o.send("Invalid Username")})}),app.get("/allListings",(e,o)=>{Listings.find().then(e=>{o.send(e)})}),app.post("/product",(e,o)=>{Listings.findById(e.body.id,(e,s)=>{o.send(s)}).catch(e=>{o.send("Can not find that item")})}),app.listen(3e3,()=>{console.log("application is running on port 3000")});